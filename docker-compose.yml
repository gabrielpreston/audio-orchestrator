version: '3.8'
services:
  stt:
    build:
      context: ./stt
      dockerfile: Dockerfile
    image: discord-voice-stt:latest
    ports:
      - "9000:9000"
    environment:
      - FW_MODEL=${FW_MODEL:-small}
      - FW_DEVICE=${FW_DEVICE:-cpu}
    restart: unless-stopped

  bot:
    build:
      context: .
      dockerfile: ./cmd/bot/Dockerfile
    image: discord-voice-bot:latest
    depends_on:
      - stt
    environment:
      - DISCORD_BOT_TOKEN=${DISCORD_BOT_TOKEN}
      - WHISPER_URL=http://stt:9000/asr
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - GUILD_ID=${GUILD_ID}
      - VOICE_CHANNEL_ID=${VOICE_CHANNEL_ID}
    volumes:
      - ./logs:/app/logs
    restart: unless-stopped
