# discord-voice-lab environment template
#
# This sample shows the split between shared defaults and service-specific
# configuration files. Copy each section into the matching path before running
# `make dev-*` or `make run`.
#
# Required variables are marked with [REQUIRED]
# Optional variables have default values or are empty

########################
# ./ .env.common       #
########################

# Logging Configuration (shared across all services)
LOG_LEVEL=info
LOG_JSON=true

# Telemetry and Monitoring (shared across services)
METRICS_PORT=9090
WAVEFORM_DEBUG_DIR=

# Logging Sampling and Rate Limiting (shared across services)
# Sample high-frequency events to reduce log volume in production
LOG_SAMPLE_VAD_N=50
LOG_SAMPLE_UNKNOWN_USER_N=100
LOG_RATE_LIMIT_PACKET_WARN_S=10
LOG_SAMPLE_STT_REQUEST_N=
LOG_SAMPLE_AUDIO_RATE=
LOG_SAMPLE_SEGMENT_READY_RATE=
LOG_SAMPLE_SEGMENT_READY_N=

# Service Warmup Flags (shared across services)
DISCORD_WARMUP_ENABLED=true
STT_WARMUP_ENABLED=true

########################
# ./ .env.docker       #
########################

# Docker Container Configuration
PUID=1000
PGID=1000
TZ=Etc/UTC

#######################################
# ./services/discord/.env.service     #
#######################################

# Discord Bot Configuration [REQUIRED]
DISCORD_BOT_TOKEN=changeme
DISCORD_GUILD_ID=000000000000000000
DISCORD_VOICE_CHANNEL_ID=000000000000000000

# Discord Connection Settings
DISCORD_AUTO_JOIN=false
DISCORD_INTENTS=guilds,guild_voice_states
DISCORD_VOICE_CONNECT_TIMEOUT=15
DISCORD_VOICE_CONNECT_ATTEMPTS=3
DISCORD_VOICE_RECONNECT_BASE_DELAY=5
DISCORD_VOICE_RECONNECT_MAX_DELAY=60

# Discord Service Modes
DISCORD_FULL_BOT=false
DISCORD_HTTP_MODE=false
DISCORD_MCP_MODE=false

# Audio Processing Configuration
AUDIO_ALLOWLIST=
AUDIO_SILENCE_TIMEOUT=0.75
AUDIO_MAX_SEGMENT_DURATION=15
AUDIO_MIN_SEGMENT_DURATION=0.3
AUDIO_AGGREGATION_WINDOW=1.5
AUDIO_SAMPLE_RATE=48000

# Voice Activity Detection (VAD)
AUDIO_VAD_SAMPLE_RATE=16000
AUDIO_VAD_FRAME_MS=30
AUDIO_VAD_AGGRESSIVENESS=2

# Wake Word Detection
WAKE_DETECTION_ENABLED=true
WAKE_MODEL_PATHS=
WAKE_PHRASES=hey atlas,ok atlas,yo atlas
ORCH_WAKE_PHRASES=
WAKE_THRESHOLD=0.5
WAKE_SAMPLE_RATE=16000

# Service URLs (using default internal ports)
STT_URL=http://stt:9000
ORCH_URL=http://orchestrator:8000

# Service Timeouts and Retries
STT_TIMEOUT=45
STT_MAX_RETRIES=3
ORCH_TIMEOUT=30

# STT Configuration
STT_FORCED_LANGUAGE=en

# MCP (Model Context Protocol) Configuration
MCP_MANIFESTS=
MCP_WEBSOCKET_URL=
MCP_COMMAND_PATH=
MCP_REGISTRATION_URL=
MCP_HEARTBEAT_INTERVAL=30

###################################
# ./services/stt/.env.service     #
###################################

# Service Configuration
STT_PORT=9000

# Faster-Whisper Model Configuration
STT_MODEL=medium.en
STT_DEVICE=cpu
STT_COMPUTE_TYPE=int8
STT_MODEL_PATH=/app/models

##################################
# ./services/llm/.env.service    #
##################################

# Service Configuration
LLM_PORT=8000
LLM_AUTH_TOKEN=changeme

# Llama.cpp Configuration
LLM_BIN=/app/llama.cpp/build/bin/llama-cli
LLM_MODEL_PATH=/app/models/llama-2-7b.Q4_K_M.gguf
LLM_CTX=2048
LLM_THREADS=4

# LLM Generation Parameters
LLM_MAX_TOKENS=128
LLM_TEMPERATURE=0.7
LLM_TOP_P=0.9
LLM_TOP_K=40
LLM_REPEAT_PENALTY=1.1

# TTS Integration
TTS_URL=http://tts:7000
TTS_VOICE=
TTS_TIMEOUT=30

#######################################
# ./services/orchestrator/.env.service #
#######################################

# Service Configuration
ORCH_PORT=8000
ORCH_AUTH_TOKEN=changeme

# Service URLs (using default internal ports)
LLM_URL=http://llm:8000
TTS_URL=http://tts:7000

# Authentication
LLM_AUTH_TOKEN=changeme
TTS_AUTH_TOKEN=changeme

# MCP Configuration
MCP_CONFIG_PATH=./mcp.json

# Debugging
ORCH_DEBUG_SAVE=false

# Test Recorder Configuration
TEST_RECORDER_RECORDINGS_DIR=/app/recordings
TEST_RECORDER_MAX_FILE_SIZE_MB=10
TEST_RECORDER_DEFAULT_SAMPLE_RATE=48000

##################################
# ./services/tts/.env.service    #
##################################

# Service Configuration
TTS_PORT=7000
TTS_AUTH_TOKEN=changeme

# Piper TTS Model Configuration
TTS_MODEL_PATH=/app/models/piper/en_US-amy-medium.onnx
TTS_MODEL_CONFIG_PATH=/app/models/piper/en_US-amy-medium.onnx.json
TTS_DEFAULT_VOICE=

# TTS Processing Limits
TTS_MAX_TEXT_LENGTH=1000
TTS_MAX_CONCURRENCY=4
TTS_RATE_LIMIT_PER_MINUTE=60

# Piper Model Parameters
TTS_LENGTH_SCALE=1.0
TTS_NOISE_SCALE=0.667
TTS_NOISE_W=0.8
